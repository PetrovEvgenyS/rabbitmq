# Кластер RabbitMQ: запуск через Docker Compose

## Описание

Этот проект предназначен для быстрого развертывания кластера RabbitMQ из трёх узлов с помощью Docker Compose. Параметры конфигурации вынесены в файл `.env` для удобства настройки и безопасности.

---

## Структура файлов

### `.env`

Файл `.env` содержит переменные окружения, используемые в `docker-compose.yml`.  
**Не рекомендуется** добавлять этот файл в репозиторий, чтобы не раскрывать чувствительные данные. Данный файл - пример. 

**Пример содержимого:**
```
RABBITMQ_IMAGE=rabbitmq:4-management
RABBITMQ_DEFAULT_USER=rmuser
RABBITMQ_DEFAULT_PASS=rmpass
RABBITMQ_ERLANG_COOKIE=sgeRr3EC4sheFs2Ee2s
RABBITMQ_DISK_LIMIT=2147483648
```

**Пояснения к переменным:**
- `RABBITMQ_IMAGE` — образ RabbitMQ с web-интерфейсом.
- `RABBITMQ_DEFAULT_USER` и `RABBITMQ_DEFAULT_PASS` — логин и пароль по умолчанию для доступа к RabbitMQ.
- `RABBITMQ_ERLANG_COOKIE` — секретный ключ для объединения узлов в кластер.
- `RABBITMQ_DISK_LIMIT` — лимит свободного места на диске (в байтах), при достижении которого RabbitMQ перестанет принимать сообщения.

---

### `docker-compose.yml`

Файл описывает три сервиса (узла RabbitMQ), каждый из которых:
- Использует параметры из `.env`
- Имеет уникальное имя контейнера и hostname
- Пробрасывает уникальный порт для web-интерфейса (15672, 15673, 15674)
- Хранит данные в отдельной папке (`./rabbitmq-1`, `./rabbitmq-2`, `./rabbitmq-3`)
- Объединён в одну сеть `rabbitmq_cluster` для взаимодействия между узлами

**Основные параметры:**
- `environment` — переменные окружения для каждого контейнера (см. выше)
- `ports` — проброс портов для доступа к web-интерфейсу каждого узла
- `volumes` — монтирование локальных папок для хранения данных RabbitMQ
- `networks` — объединение контейнеров в одну сеть для кластера

---

## Запуск кластера

1. **Создайте и настройте файл `.env`** (можно скопировать из примера выше).
2. **Запустите кластер:**
   ```
   docker-compose --env-file .env up -d
   ```
3. **Доступ к web-интерфейсу:**
   - Первый узел: [http://localhost:15672](http://localhost:15672)
   - Второй узел: [http://localhost:15673](http://localhost:15673)
   - Третий узел: [http://localhost:15674](http://localhost:15674)
   - Логин и пароль — из `.env` (`RABBITMQ_DEFAULT_USER` / `RABBITMQ_DEFAULT_PASS`)

